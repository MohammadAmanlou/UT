DROP DATABASE IF EXISTS MMD_DB;
CREATE DATABASE MMD_DB;
USE MMD_DB;

CREATE TABLE GENRE(
	GID INTEGER,
	name CHAR(20),
	PRIMARY KEY (gid)
);

CREATE TABLE Admin (
	AID CHAR(20),
	name CHAR(20),
	role CHAR(20),
	salary REAL,
	PRIMARY KEY (AID)
);

CREATE TABLE Customer (
	CID CHAR(20),
	phone CHAR(20),
	name CHAR(20),
	PRIMARY KEY (CID)
); 

CREATE TABLE Student (
	CID CHAR(20),
	uni CHAR(20),
	SID CHAR(20),
	discount INTEGER,
	PRIMARY KEY (CID),
	FOREIGN KEY (CID) REFERENCES Customer(CID) ON DELETE NO ACTION, 
	UNIQUE (SID)
);

CREATE TABLE BoardGameAdmin(
	BID INTEGER,
	name CHAR(20),
	version CHAR(20),
	publisher CHAR(20),
	status CHAR(20),
	AID CHAR(20) NOT NULL,
	PRIMARY KEY (BID),
	FOREIGN KEY (AID) REFERENCES Admin(AID) ON DELETE NO ACTION
);

CREATE TABLE DigitalBoardGame(
	BID INTEGER,
	price REAL,
	PRIMARY KEY (BID),
	FOREIGN KEY (BID) REFERENCES BoardGameAdmin(BID) ON DELETE NO ACTION
)

CREATE TABLE PhysicalBoardGame(
	BID INTEGER,
	price REAL,
	PRIMARY KEY (BID),
	FOREIGN KEY (BID) REFERENCES BoardGameConfirm(BID) ON DELETE NO ACTION
);

CREATE TABLE BoardgameGenre(
	BID INTEGER,
	GID INTEGER,
	PRIMARY KEY (BID,GID),
	FOREIGN KEY (BID) REFERENCES BoardGameConfirm(BID) ON DELETE NO ACTION,
	FOREIGN KEY (GID) REFERENCES Genre(GID) ON DELETE NO ACTION
);


CREATE TABLE Score(
	CID INTEGER,
	BID INTEGER,
	score INTEGER,
	PRIMARY KEY (CID,BID),
	FOREING KEY (BID) REFERENCES BoardGameConfirm(BID) ON DELETE NO ACTION,
	FOREING KEY (CID) REFERENCES Customer(CID) ON DELETE CASCADE
);

CREATE TABLE Download(
	BID INTEGER,
	CID INTEGER,
	date DATE,
	discount INTEGER,
	PRIMARY KEY (BID,CID),
	FOREIGN KEY (BID) REFERENCES Digital_BoardGame(BID) ON DELETE NO ACTION,
	FOREIGN KEY (CID) REFERENCES Customer(CID) ON DELETE CASCADE
);

CREATE TABLE Delivery(
	DID INTEGER,
	commission_fee INTEGER,
	type CHAR(20),
	name CHAR(20),
	phone CHAR(20),
	PRIMARY KEY (DID)
);


CREATE TABLE BuyRecord(
	BRID CHAR(20),
	delivery_cost REAL,
	total_cost REAL,
	date DATE,
	discount INTEGER,
	CID CHAR(20) NOT NULL,
	PRIMARY KEY (BRID),
	FOREIGN KEY (CID) REFERENCES Customer(CID) ON DELETE CASCADE
);


CREATE TABLE BuyRecordBoardGame (
	BRID CHAR(20),
        BID CHAR(20) NOT NULL,
        PRIMARY KEY (BRID , BID), 
        FOREIGN KEY (BRID) REFERENCES Buy_Record(BRID) ON DELETE NO ACTION ,
        FOREIGN KEY (BID) REFERENCES PhysicalBoardGame(BID) ON DELETE NO ACTION
);


CREATE TABLE Delivered (
	DID CHAR(20) NOT NULL,
	BRID CHAR(20),
	PRIMARY KEY (BRID), 
	FOREIGN KEY (BRID) REFERENCES Buy_Record_Order(BuyID) ON DELETE NO ACTION ,
	FOREIGN KEY (DID) REFERENCES delivery(DID) ON DELETE NO ACTION 
);
